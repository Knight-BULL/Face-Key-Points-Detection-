# Face-Key-Points-Detection
Face Key Point Detection  On Win10 With Cafe And VS2015

# 1.数据（datasets）
## 1.1数据说明（Data Description）
1.数据有17000多张人脸图片，其中标注文件13000多个。
2.每张图有7个关键点，每张图片的标注文件第0个是文件名，1，2是矩形框左上角，3,4是矩形框右下角
6-12 对应点的x轴坐标，12-18对应点的y轴坐标。point0是左眼眼角,point1是左眼右眼角，point2是
右眼左眼角,point3是右眼右眼角，point4是鼻子，point5是左嘴角，point6是右嘴角。
![图片加载失败](https://github.com/thehappysheep/Face-Key-Points-Detection-/blob/master/example.jpg)
# 2编程思想
## 2.1数据检查
检查标注文件每一行是否有19个数据，如果有数据缺失，除去缺失项
## 2.2图片预处理
1.根据标签中图片名字读取图片。
2.根据标注文件把图片中的人脸剪切出来然后编程灰度图片然后压缩到网络需要的size。
## 2.3关键点数据处理
1.裁剪后关键点相对原来的参考点发生变化，相当于平移，把裁剪后的图框左上角作为参考点。
2.图片压缩后相对与要来尺寸发生变化要成一个scale，等于压缩尺寸/裁剪图框尺寸。
## 2.4 生成HDF5文件
1.读取条标注处理一个图片
# 3.编程遇到的问题
1.编程思想很重要，刚开始我编程生成各种中间文件，处理起来很麻烦，后来使用直接生成目标文件。
2.在处理时候洗牌很重要（shuffle），可以在直接在标注数据中打乱顺序，直接根据标注文件读取图片。
3.需要从训练数据中随机拿10%-20%作为验证文件。
4.生成HDF5文件时候标签和数据要对应，可以提前定义好标签和数据的数据格式使用numpy，比如
  data =np.zeros((datasize,pic_depth,pic_width,pic_high),dtype=np.float32)。等数据全部
  读到定义的数组内在写入HDF5文件中；读一次写一次会导致转化速度特别慢（教训）。
5.在train_val_net.prototxt文件中不能直接读取hdf5文件，需要把HDF5地址写到txt文件中，不加“”。
6.编程时候注意函数的封装模块化和日志打印。

# 备注：
1.caffe中要求1个hdf5文件大小不超过2GB，所以如果数据量太大，建议生成多个hdf5文件。

